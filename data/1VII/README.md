Overview
=========


## Data collection for nsnt.gp

To collect data lonestar
```
./syncin
make
```

## Data collection for whamcmp.gp

For the old whamcmp.gp for all data points
```
./mkwhamcmp.sh
```

For the new whamcmp.gp for subsamples
```
./mkwhamcmp.sh
cd whamcmpr0.01   && ./gen.sh && make && cd ..
cd whamcmpr0.0001 && ./gen.sh && make && cd ..
```




Files
=====


File            | Description
----------------+--------------------------------------------------------------------
mkwhamcmp.sh    | script to generate files for the GNUplot script doc/fig/whamcmp.gp. This is sufficient only the old whacmp.gp, which applies to the entire data set. For the new version, which is compute for subsamples, check the subdirectories, whamcmpr0.01 and whamcmpr0.0001.  However, mbar.out is still needed, which can be generated either by mkwhamcmp.sh or manually.
xvgrun.py       | running script to measure the number of iterations and run time, output used for doc/fig/nsnt.gp, the output is .log
xvgtrace.py     | running script to measure the decay of error, not used, the output is .tr
xvgerr.py       | running script to estimate of error, output used for doc/fig/whamcmp.gp, the output is .log
stat.py         | script to analyze the data generated by xvgrun.py and xvgtrace.py
addlnzref.py    | add a column of the reference values of partition functions to whamxxx.out, used in `mkwhampcmp.sh`
T\_scan.sh      | generate e.xvg for NVT simulation trajectories
TP\_scan.sh     | generate ev.xvg for NPT simulation trajectories
mkT.sh          | prepare systems for NVT simulations
mkTPxxx.sh      | prepare systems for NPT simulations
prep.py         | prepare system for GROMACS simulations (low level), called in mkTxxx.sh and mkTPxxx.sh
T\_extend.sh    | extend simulation time (no longer needed)
uploadTPxxx.sh  | update initial files for running on Lonstar




Making the comparison figure
=============================

./mkwhamcmp.sh


Protocols
==========

The file give detailed protocols for data collection.

`prep.py` is the script to prepare system for GROMACS.


## NVT ensemble ##

### Prepare systems ###

On lonestar first go to the scratch directory:
```
cds wham/data/1VII
```

Prepare systems one-by-one:
```
./prep.py -T 300 --nt=4
./prep.py -T 310 --nt=4
...
./prep.py -T 410 --nt=4
```
Here, `--nt=4` limits the number of threads to 4.

Locally, the above steps can be combined as
```
./mkT.sh
```



### Run simulations ###

On lonestar
```
qsub T_lonestar.pbs
```

Locally
```
cd T300
~/lwork/gmx/gromacs5.0/buildgcc/bin/gmx mdrun -v -deffnm nvt
```



### Export energy ###

```
./T_scan.sh
```

Manually
```
~/lwork/gmx/gromacs5.0/buildgcc/bin/gmx energy -f nvt.edr -o e.xvg
```
Select "Potential" (11) and possibly "Pressure" (17).



### Run WHAM ###

```
cd ../../prog/gmx
ls --color=none -d ../../data/1VII/T[0-9][0-9][0-9]/e.xvg > e.ls
./xvgwham e.ls --wham=mdiis
```



### Run MBAR ###

```
./xvgmbar e.ls --wham=mdiis
```



### Benchmark ###

For the number of iteractions needed to reach an error tolerance
```
python xvgrun.py
python stat.py
```

For the error versus the number of iteractions
```
python xvgtrace.py
python stat.py
```





## NPT ensemble ##

### Prepare systems ###

On lonestar first go to the scratch directory:
```
cds wham/data/1VII
```

Prepare systems one-by-one:
```
./prep.py -T 300 -P 1    --nt=4
./prep.py -T 310 -P 1.05 --nt=4
...
./prep.py -T 410 -P 1.15 --nt=4
```
Here, `--nt=4` limits the number of threads to 4.

Locally, the above steps can be combined as
```
./mkTP.sh
```

For the second set, use `mkTP2.sh`.
For the two-dimensional set, use `mkTP2d.sh`.





### Run simulations ###

On lonestar
```
qsub TP_lonestar.pbs
```

Locally
```
cd T300P1
~/lwork/gmx/gromacs5.0/buildgcc/bin/gmx mdrun -v -deffnm npt
```



### Export energy ###

```
./TP_scan.sh
```
For the second set
```
./TP_scan.sh 2
```

Manually,
```
~/lwork/gmx/gromacs5.0/buildgcc/bin/gmx energy -f npt.edr -o ev.xvg
```
Select "Potential" (11), "Pressure" (16), and "Volume" (21).



### Run WHAM2 ###

```
cd ../../prog/gmx
ls --color=none -d ../../data/1VII/T[0-9][0-9][0-9]/ev.xvg > ev.ls
./xvgwham2 ev.ls --wham=mdiis
```

```
python xvgrun.py --ev
```



### Run MBAR2 ###

```
./xvgmbar2 ev.ls --wham=mdiis
```



### Benchmark ###

For the number of iteractions needed to reach an error tolerance
```
python xvgrun.py --ev
python stat.py
```

For the error versus the number of iteractions
```
python xvgtrace.py --ev
python stat.py
```





